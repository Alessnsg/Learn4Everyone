<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/google-signin/google-signin.html">
<link rel="import" href="../login/learn-toolbar.html">
<link rel="import" href="../login/learn-login.html">
<link rel="import" href="../learn-courses/learn-courses.html">


<dom-module id="learn-app">
  <template>
    <style include="learn-app-custom-styles" ></style>

    <!-- Route service -->
    <app-location route="{{route}}" ></app-location>
    <app-route
      route="{{route}}"
      pattern="[[pattern]]"
      data="{{router}}"
      tail="{{subroute}}"
    >
    </app-route>

    <iron-pages
      role="main"
      selected="[[router.page]]"
      attr-for-selected="route"
      selected-attribute="visible"
      fallback-selection="not-found"
    >
      <learn-courses route="courses" ></learn-courses>
    </iron-pages>

    <learn-toolbar
    signed-in="[[signedIn]]"
    on-sign-out="signOut"
    user-data="[[userData]]">
    </learn-toolbar>

  <learn-login
    on-sign-in="signIn"
    signed-in="[[signedIn]]"
    disabled="[[!online]]">
    </learn-login>
  
  <firebase-auth
    id="auth"
    app-name="learn4everyone"
    provider="google"
    signed-in="{{signedIn}}">
    </firebase-auth>

    <firebase-app
    name="learn4everyone"
    api-key="AIzaSyBL7hd9LafQluVljDXZK9V_F2eIhA0CS0c"
    auth-domain="learn4everyone-80ba5.firebaseapp.com"
    database-url="https://learn4everyone-80ba5.firebaseio.com">
  </firebase-app>

  </template>
  <script>
    /**
    * @customElement
    * @polymer
    **/
    class LearnApp extends Polymer.Element {
      static get is() {
        return 'learn-app'
      }

      static get properties() {
        return {
          /**
          * Route service properties
          **/

          /**
          * @name route
          * @type {Object}
          * @public
          * @description Store current route configuration
          **/
          route: {
            type: Object
          },

          /**
          * @name router
          * @type {Object}
          * @public
          * @description Store data obtained from route object
          **/
          router: {
            type: Object
          },

          /**
          * @name subroute
          * @type {Object}
          * @public
          * @description Store subroute/tail configuration from current route
          **/
          subroute: {
            type: Object
          },

          /**
          * @name pattern
          * @type {String}
          * @public
          * @description Pattern to configure current router properties @see {router} {route} {subroute}
          **/
          pattern: {
            type: String,
            value: '/:page'
          },

          /**
          * Courses properties
          **/
          courses: {
            type: Array
          },
          userData: {
            type: Object,
            value: () => { return {} },
            reflectToAttribute: true,
          }
        }
      }

      ready() {
        super.ready();
      }

      signIn() {
        let isSignin = this.$.auth.signInWithPopup();
	      isSignin.then( (data) => {
          this.userData = data.additionalUserInfo.profile;
        });
	    }

      signOut() {
        if (this.$.auth) {
          this.$.auth.signOut();
        }
      }
    }

    window.customElements.define(LearnApp.is, LearnApp);
  </script>
</dom-module>
